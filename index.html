<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>REBELZ Food Truck Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet CSS for the map -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <img
          src="rebelz-logo.png"
          alt="REBELZ Food Truck logo"
          class="logo-img"
        />
        <div>
          <h1>REBELZ Food Truck Tracker</h1>
          <p>Find us in real time, grab your favorites.</p>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="card card-info">
        <h2>Current Status</h2>
        <p id="statusText">Loading current location…</p>
        <p class="sub" id="updatedAt"></p>
        <button id="refreshBtn" class="btn">Refresh Location</button>
      </section>

      <section class="card card-map">
        <h2>Live Map</h2>
        <div id="map"></div>
        <p class="sub">
          Pin shows the latest location of the REBELZ truck. Refresh if it looks
          out of date.
        </p>
      </section>

      <section class="card card-schedule">
        <h2>Today’s Schedule</h2>
        <ul class="schedule">
          <li><strong>Evening:</strong> 5:30 PM – 9:00 PM</li>
          <li><strong>Dinner:</strong> 11:00 PM – 2:15 AM</li>
        </ul>
        <p class="sub">
          Check our socials for changes due to weather or private events.
        </p>
      </section>

      <section class="card card-links">
        <h2>Stay Connected</h2>
        <div class="link-grid">
          <a href="#" class="link-pill">Instagram</a>
          <a href="#" class="link-pill">TikTok</a>
          <a href="#" class="link-pill">Website</a>
          <a href="mailto:info@rebelztruck.com" class="link-pill">Contact</a>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>© <span id="year"></span> REBELZ Food Truck. All rights reserved.</p>
    </footer>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    const mapElement = document.getElementById("map");
    const statusText = document.getElementById("statusText");
    const updatedAt = document.getElementById("updatedAt");
    const refreshBtn = document.getElementById("refreshBtn");
    const yearSpan = document.getElementById("year");
    yearSpan.textContent = new Date().getFullYear();

    // Default starting position (change to your city if you like)
    const DEFAULT_LAT = 40.7128;
    const DEFAULT_LNG = -74.0060;
    const DEFAULT_ZOOM = 13;

    let map = L.map(mapElement).setView([DEFAULT_LAT, DEFAULT_LNG], DEFAULT_ZOOM);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    let marker = L.marker([DEFAULT_LAT, DEFAULT_LNG]).addTo(map);

    async function fetchLocation() {
      try {
        statusText.textContent = "Updating location…";

        const res = await fetch("location.json?cacheBust=" + Date.now());
        if (!res.ok) {
          throw new Error("Could not load location.json");
        }

        const data = await res.json();
        const lat = data.lat;
        const lng = data.lng;
        const locationName = data.locationName || "On the move";
        const lastUpdated = data.lastUpdated;

        if (typeof lat !== "number" || typeof lng !== "number") {
          throw new Error("Invalid coordinates");
        }

        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], DEFAULT_ZOOM);

        statusText.textContent = `We’re currently at: ${locationName}`;
        updatedAt.textContent = lastUpdated
          ? `Last updated: ${lastUpdated}`
          : "";

      } catch (err) {
        console.error(err);
        statusText.textContent =
          "We couldn’t load the live location. Try again in a moment.";
        updatedAt.textContent =
          "If this keeps happening, the truck might be offline or location.json needs updating.";
      }
    }

    refreshBtn.addEventListener("click", fetchLocation);

    // Initial load + optional auto-refresh
    fetchLocation();
    // Auto-refresh every 30 seconds:
    // setInterval(fetchLocation, 30000);
  </script>
</body>
</html>
